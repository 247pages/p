<!DOCTYPE html>
<html>
<head>
  <title>JioPhone CCTV</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; text-align: center; }
    video { width: 100%; max-height: 240px; background: #000; }
    #status { margin-top: 10px; font-size: 14px; }
  </style>
</head>
<body>
  <h3>üìπ JioPhone CCTV</h3>
  <video id="local" autoplay muted></video>
  <div id="status">Starting...</div>

  <script>
    const BOT_TOKEN = "6675607272:AAFIafZckGOmNT8m9mE66_YgaBzkD3wo_xg";
    const CHAT_ID = "-1001590820560";
    const OFFER_URL = "https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPO/main/offer.json"; 
    // üëÜ replace with your GitHub raw file URL

    let pc = new RTCPeerConnection();
    let local = document.getElementById("local");
    let status = document.getElementById("status");

    pc.oniceconnectionstatechange = () => {
      status.innerText = "ICE state: " + pc.iceConnectionState;
    };

    // Capture camera + mic
    navigator.mediaDevices.getUserMedia({ video: true, audio: true })
      .then(stream => {
        local.srcObject = stream;
        stream.getTracks().forEach(t => pc.addTrack(t, stream));
        status.innerText = "‚úÖ Camera/Mic ready, waiting for offer...";
        fetchOffer();
      })
      .catch(err => status.innerText = "‚ùå Media error: " + err.message);

    // Fetch offer from GitHub
    async function fetchOffer() {
      try {
        const res = await fetch(OFFER_URL + "?t=" + Date.now()); // avoid cache
        if (!res.ok) throw new Error("Offer not found");
        const offer = await res.json();
        await pc.setRemoteDescription(new RTCSessionDescription(offer));
        status.innerText = "üì° Offer received, creating answer...";
        createAnswer();
      } catch (err) {
        status.innerText = "Retrying fetch...";
        setTimeout(fetchOffer, 4000);
      }
    }

    async function createAnswer() {
      let answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
      sendToTelegram(JSON.stringify(answer));
      status.innerText = "‚úÖ Answer created and sent to Telegram";
    }

    function sendToTelegram(text) {
      const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(text)}`;
      fetch(url).catch(err => status.innerText = "‚ùå Telegram error: " + err);
    }
  </script>
</body>
</html>

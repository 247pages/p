<!DOCTYPE html>
<html>
<head>
  <title>JioPhone CCTV Snapshots</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family:sans-serif; background:#111; color:#eee; text-align:center; }
    video, canvas { width:90%; margin:10px; background:#000; }
    button { padding:10px; margin:10px; width:90%; font-size:14px; }
    pre { text-align:left; font-size:12px; background:#222; padding:5px; white-space:pre-wrap; }
  </style>
</head>
<body>
  <h3>üì∏ JioPhone CCTV Snapshots</h3>
  <video id="video" autoplay playsinline muted></video>
  <canvas id="canvas" style="display:none;"></canvas>
  <button onclick="start()">Start Sending</button>
  <button onclick="stop()">Stop</button>
  <pre id="log">Idle...</pre>

  <script>
    const BOT_TOKEN = "6675607272:AAFIafZckGOmNT8m9mE66_YgaBzkD3wo_xg";
    const CHAT_ID = "-1001590820560";

    let video = document.getElementById("video");
    let canvas = document.getElementById("canvas");
    let logEl = document.getElementById("log");
    let intervalId = null;

    function log(msg) {
      logEl.innerText += "\n" + msg;
      logEl.scrollTop = logEl.scrollHeight;
    }

    async function start() {
      log("‚ñ∂Ô∏è Starting camera...");
      try {
        let stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        log("‚úÖ Camera started");

        intervalId = setInterval(captureAndSend, 5000); // every 5s
      } catch (err) {
        log("‚ùå getUserMedia error: " + err.message);
      }
    }

    function stop() {
      if (intervalId) {
        clearInterval(intervalId);
        intervalId = null;
        log("‚èπÔ∏è Stopped sending snapshots");
      }
      if (video.srcObject) {
        video.srcObject.getTracks().forEach(t => t.stop());
        video.srcObject = null;
      }
    }

    function captureAndSend() {
      if (!video.srcObject) {
        log("‚ö†Ô∏è No camera stream");
        return;
      }
      let ctx = canvas.getContext("2d");
      canvas.width = video.videoWidth || 160;
      canvas.height = video.videoHeight || 120;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      canvas.toBlob(blob => {
        if (!blob) return;
        log("üì§ Sending snapshot...");
        sendToTelegram(blob);
      }, "image/jpeg", 0.5); // quality 0.5 for smaller size
    }

    function sendToTelegram(blob) {
      let formData = new FormData();
      formData.append("chat_id", CHAT_ID);
      formData.append("photo", blob, "snapshot.jpg");

      let xhr = new XMLHttpRequest();
      xhr.open("POST", "https://api.telegram.org/bot" + BOT_TOKEN + "/sendPhoto", true);
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) log("‚úÖ Snapshot sent");
          else log("‚ùå Telegram error: " + xhr.status);
        }
      };
      xhr.send(formData);
    }
  </script>
</body>
</html>
